<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Estadísticas Voleibol (Mobile Controls)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background:#f0f2f5; font-family:sans-serif }
    .card { background:#fff; border-radius:.75rem; padding:1.5rem; margin-bottom:1.5rem;
            box-shadow:0 4px 6px rgba(0,0,0,0.1) }
    .btn { display:inline-block; padding:.25rem .5rem; border-radius:.375rem;
           font-weight:600; cursor:pointer; user-select:none }
    .btn-inc { background:#10b981; color:#fff }
    .btn-dec { background:#ef4444; color:#fff }
    .btn-primary { background:#3b82f6; color:#fff }
    .btn-secondary { background:#64748b; color:#fff }
    .valor { font-size:1.25rem; font-weight:500; margin: .5rem 0; }
    /* responsive */
    #table-wrapper { display:none }
    #mobile-list  { display:block }
    @media(min-width:640px) {
      #table-wrapper { display:block }
      #mobile-list  { display:none }
    }
  </style>
</head>
<body class="p-4">
  <div class="max-w-xl mx-auto">

    <!-- Información del partido -->
    <div class="card">
      <h2 class="text-xl font-bold mb-4">Información del Partido</h2>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
        <input id="equipo" placeholder="Equipo Rival" class="p-2 border rounded"/>
        <input id="set"    placeholder="Set"           class="p-2 border rounded"/>
        <input id="ganador"placeholder="Ganador Set"   class="p-2 border rounded"/>
      </div>
    </div>

    <!-- Tabla clásica (>=640px) -->
    <div id="table-wrapper" class="card overflow-x-auto">
      <h2 class="text-xl font-bold mb-4">Tabla de Estadísticas</h2>
      <!-- ... tu tabla igual que antes ... -->
    </div>

    <!-- Lista móvil (<640px) -->
    <div id="mobile-list">
      <button onclick="agregarFila()" class="btn btn-primary mb-4">Agregar jugador</button>
      <div id="mobile-cards" class="space-y-4"></div>
    </div>

    <!-- Gráficos -->
    <div class="card">
      <h2 class="text-xl font-bold mb-4">Estadísticas Individuales (%)</h2>
      <div id="charts-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
    </div>

    <!-- Acciones -->
    <div class="card flex space-x-4">
      <button onclick="registrarSet()" class="btn btn-primary">Registrar Set</button>
      <button onclick="descargarCSV()" class="btn btn-secondary">Descargar CSV</button>
    </div>
  </div>

  <script>
    const sets = [], charts = [];

    // genera 15 celditas para tabla (igual que antes)…
    function generarCeldas(i){ /* … */ }

    function agregarFila(){
      const i = charts.length;
      // 1) tabla (igual que antes)… omitido para brevedad

      // 2) tarjeta móvil
      const card = document.createElement('div');
      card.className = 'card';
      card.id = `mobile-card-${i}`;
      card.innerHTML = `
        <h3 class="font-bold mb-2" id="mobile-title-${i}">Jugador ${i+1}</h3>
        <div class="space-y-4">
          ${['Saque','Recepción','Ataque'].map((accion,j)=>`
            <div class="border rounded p-2">
              <p class="text-center font-medium mb-1">${accion}</p>
              <div class="flex flex-col items-center">
                <button class="btn btn-inc" onclick="modificarMobile(${i}, ${j}, 1)">+</button>
                <span id="mobile-val-${i}-${j}" class="valor">0%</span>
                <button class="btn btn-dec" onclick="modificarMobile(${i}, ${j}, -1)">−</button>
              </div>
            </div>`).join('')
        }
        </div>`;
      document.getElementById('mobile-cards').append(card);

      // 3) gráfico (igual que antes)…
      const cont = document.createElement('div');
      cont.className = 'card w-full h-48';
      cont.innerHTML = `<h3 id="chart-title-${i}" class="text-center font-bold mb-2">Jugador ${i+1}</h3>
                        <canvas id="chart-${i}" class="w-full h-32"></canvas>`;
      document.getElementById('charts-grid').append(cont);

      charts.push(null);
      inicializarDatos(i);
      actualizarGrafico(i);
    }

    // inicializa un array de 15 ceros para cada jugador
    function inicializarDatos(i){
      window[`dataVals${i}`] = Array(15).fill(0);
    }

    // modifica desde móvil: encuentra el slice [j] (0: saque, 1: recep, 2:ataque)
    function modificarMobile(i, categoria, delta){
      // sumamos delta a la categoría: recorremos 5 posiciones de cada bloque
      const vals = window[`dataVals${i}`];
      // para simplicidad, añadiremos/substraeremos 1 del primer valor de la categoría
      // tú puedes ajustar para que ciclen u otro comportamiento
      const idx = categoria*5; 
      vals[idx] = Math.max(0, vals[idx] + delta);
      actualizarMobileUI(i);
      actualizarGrafico(i);
    }

    function actualizarMobileUI(i){
      const vals = window[`dataVals${i}`];
      ['Saque','Recepción','Ataque'].forEach((_,j)=>{
        const arr = vals.slice(j*5, j*5+5);
        const total = arr.reduce((a,b)=>a+b,0);
        const peso = [0,0.25,0.5,0.75,1];
        const prec = total
          ? arr.reduce((s,c,k)=>s + c*peso[k],0)/total*100
          : 0;
        document.getElementById(`mobile-val-${i}-${j}`)
                .textContent = prec.toFixed(0) + '%';
      });
    }

    function actualizarGrafico(i){
      // similar a tu función anterior, pero leyendo window[`dataVals${i}`]
      // … recrea el bar chart y lo coloca o actualiza en charts[i]
    }

    function registrarSet(){ /* … */ }
    function descargarCSV(){ /* … */ }

    window.onload = agregarFila;
  </script>
</body>
</html>